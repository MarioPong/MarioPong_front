<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2ptest Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    button {
      cursor: pointer;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      background-color: #007bff;
      color: white;
      font-size: 1rem;
      position: relative;
      z-index: 10;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    #gameArea {
      margin-top: 20px;
      border: 1px solid #ccc;
      height: 400px;
      position: relative;
      background-color: #000;
    }
    #roomNameInput {
      padding: 8px;
      font-size: 1rem;
      margin-right: 10px;
    }
    .player-info {
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>2ptest Game</h1>
  <div>
    <input type="text" id="roomNameInput" placeholder="Enter room name" />
    <button id="joinRoomBtn">Join Room</button>
    <button id="leaveRoomBtn" disabled>Leave Room</button>
  </div>
  <div class="player-info">
    <div>P1: <span id="p1Name">-</span> <button id="p1ReadyBtn" disabled>Ready</button></div>
    <div>P2: <span id="p2Name">-</span> <button id="p2ReadyBtn" disabled>Ready</button></div>
  </div>
  <div id="gameArea">
    <!-- Game canvas or elements will be here -->
  </div>
  <div style="margin-top: 20px;">
    <button id="skillBtn" disabled>Use Skill</button>
    <button id="exitBtn" disabled>Exit</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io('/pong');
  let currentRoom = null;
  let playerIndex = null;

  const joinRoomBtn = document.getElementById('joinRoomBtn');
  const leaveRoomBtn = document.getElementById('leaveRoomBtn');
  const roomNameInput = document.getElementById('roomNameInput');
  const p1NameSpan = document.getElementById('p1Name');
  const p2NameSpan = document.getElementById('p2Name');
  const p1ReadyBtn = document.getElementById('p1ReadyBtn');
  const p2ReadyBtn = document.getElementById('p2ReadyBtn');
  const skillBtn = document.getElementById('skillBtn');
  const exitBtn = document.getElementById('exitBtn');

  joinRoomBtn.addEventListener('click', () => {
    const roomName = roomNameInput.value.trim();
    if (!roomName) {
      alert('Please enter a room name');
      return;
    }
    socket.emit('joinRoom', roomName, 'Player');
  });

  leaveRoomBtn.addEventListener('click', () => {
    if (currentRoom) {
      socket.emit('leaveRoom', currentRoom);
    }
  });

  p1ReadyBtn.addEventListener('click', () => {
    socket.emit('ready', 'Character1');
  });

  p2ReadyBtn.addEventListener('click', () => {
    socket.emit('ready', 'Character2');
  });

  skillBtn.addEventListener('click', () => {
    socket.emit('useSkill');
  });

  exitBtn.addEventListener('click', () => {
    if (currentRoom) {
      socket.emit('leaveRoom', currentRoom);
    }
  });

  socket.on('roomFull', (data) => {
    alert(data.message);
  });

  socket.on('enteredRoom', (index) => {
    currentRoom = roomNameInput.value.trim();
    playerIndex = index;
    joinRoomBtn.disabled = true;
    leaveRoomBtn.disabled = false;
    skillBtn.disabled = false;
    exitBtn.disabled = false;
    if (playerIndex === 0) {
      p1ReadyBtn.disabled = false;
      p2ReadyBtn.disabled = true;
    } else if (playerIndex === 1) {
      p1ReadyBtn.disabled = true;
      p2ReadyBtn.disabled = false;
    }
  });

  socket.on('roomInfo', (players) => {
    p1NameSpan.textContent = players[0] ? players[0].userName : '-';
    p2NameSpan.textContent = players[1] ? players[1].userName : '-';
  });

  socket.on('startGame', () => {
    alert('Game started!');
  });

  socket.on('gameOver', (data) => {
    alert(`Game over! Winner: Player ${data.winner + 1}`);
    joinRoomBtn.disabled = false;
    leaveRoomBtn.disabled = true;
    skillBtn.disabled = true;
    exitBtn.disabled = true;
    p1ReadyBtn.disabled = true;
    p2ReadyBtn.disabled = true;
    currentRoom = null;
    playerIndex = null;
  });

  socket.on('disconnect', () => {
    alert('Disconnected from server');
    joinRoomBtn.disabled = false;
    leaveRoomBtn.disabled = true;
    skillBtn.disabled = true;
    exitBtn.disabled = true;
    p1ReadyBtn.disabled = true;
    p2ReadyBtn.disabled = true;
    currentRoom = null;
    playerIndex = null;
  });
</script>
</body>
</html>
